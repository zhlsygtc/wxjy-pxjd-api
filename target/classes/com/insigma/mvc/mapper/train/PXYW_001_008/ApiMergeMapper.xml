<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.insigma.mvc.dao.train.PXYW_001_008.ApiMergeMapper">
    <select id="getHb68List" parameterType="Hb68" resultType="Hb68">
		select
	        chb100,
	        a.chb068,
	        aae001,
	        chb315,
	        (select aaa103 from v_aa10 where aaa100 = 'ACA109' and aaa102=a.aca111) aca111,
	        (select code_name from code_value where code_type = 'CHB103' and code_value=a.chb103) chb103,
	        a.chb106,
	        to_char(a.chb107, 'yyyy-MM-dd') chb107,
	        to_char(a.chb108, 'yyyy-MM-dd') chb108,
	        (select code_name from code_value where code_type = 'CHB111' and code_value=a.chb111) chb111,
	        c.chb101,
	        a.chb527
	    from
	        HB68 a full join 
	        HB66 b on 
	        a.chb068 = b.chb068
	        full join 
	        hb67 c on
	        b.chb067 = c.chb067
	    where
            a.aae100 = '1' and
            a.chb527 = '0' and
            a.chb111 = '06' and
	        a.aab001 = #{aab001}
          <if test="chb100!=null">
            and a.chb100 like '%'||#{chb100}||'%'
          </if>
          <if test="aca111!=null">
            and a.aca111 = #{aca111}
          </if>
          <if test="chb103!=null">
        	and a.chb103 = #{chb103}
          </if>
          <if test="chb107!=null">
        	and to_char(a.chb107,'yyyy-MM-dd') <![CDATA[>=]]> #{chb107}
          </if>
          <if test="chb108!=null">
        	and to_char(a.chb108,'yyyy-MM-dd') <![CDATA[<=]]> #{chb108}
          </if>
          <if test="chb111!=null">
        	and a.chb111 = #{chb111}
          </if>
          <if test="chb101!=null">
        	and c.chb101 like '%'||#{chb101}||'%'
          </if>
          <if test="chb527!=null">
        	and a.chb527 = #{chb527}
          </if>
   			order by c.chb101,chb100 desc 
    </select>
    <select id="getHb68ByChb068" parameterType="Hb68" resultType="Hb68" >
    	select 
		  aca111,
		  chb103,
		  aab001,
		  to_char(chb107,'yyyy-MM-dd') chb107,
		  to_char(chb108,'yyyy-MM-dd') chb108,
		  chb105
		from 
		  hb68
		where 
		  aae100 = '1' and
		  chb068 = #{chb068}
    </select>
    <select id="getChb106All" parameterType="Hb68" resultType="Hb68" >
    	select 
		  count(*) chb106
		from 
		  hc66
		where 
		  chc001 in 
		  (select 
		     chc001
		   from 
		     hc60
		   where 
		     chb068 in
		     (select 
		        chb068 
		      from 
		        hb68 
		      where 
		        chb068 in <foreach item="item" collection="chb068s" open="(" separator="," close=")">
            				#{item}
        	              </foreach>) and
		    czc018 = '1' and eae052 = '1') and
		  chc018 = '1'
    </select>
    <insert id="addMargeClass" parameterType="Hb67">
     	insert into hb67
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        CHB067,
	      <if test="chb107 != null">
	        CHB107,
	      </if>
	      <if test="chb108 != null">
	        CHB108,
	      </if>
	      <if test="chb101 != null">
	        CHB101,
	      </if>
	      <if test="aab001 != null">
	        AAB001,
	      </if>
	      <if test="chb103 != null">
	        CHB103,
	      </if>
	      <if test="aca111 != null">
	        ACA111,
	      </if>
	      <if test="chb105 != null">
	        CHB105,
	      </if>
	      <if test="chb106 != null">
	        CHB106,
	      </if>
	      <if test="aae100 != null">
	        AAE100,
	      </if>
	      <if test="aae011 != null">
	        AAE011,
	      </if>
	      <if test="aae013 != null">
	      	AAE013,
	      </if>
	      <if test="aae036 != null">
	      	AAE036,
	      </if>
	      <if test="chb528 != null">
	      	CHB528,
	      </if>
	      <if test="chb316 != null">
	      	CHB316,
	      </if>
	      <if test="chb188 != null">
	      	CHB188
	      </if>
	    </trim>
	    <trim prefix="values (" suffix=")" suffixOverrides=",">
	        #{chb067,jdbcType=VARCHAR},
	      <if test="chb107 != null">
	        to_date(#{chb107}, 'yyyy-MM-dd'),
	      </if>
	      <if test="chb108 != null">
	        to_date(#{chb108}, 'yyyy-MM-dd'),
	      </if>
	      <if test="chb101 != null">
	        #{chb101,jdbcType=VARCHAR},
	      </if>
	      <if test="aab001 != null">
	        #{aab001,jdbcType=VARCHAR},
	      </if>
	      <if test="chb103 != null">
	        #{chb103,jdbcType=VARCHAR},
	      </if>
	      <if test="aca111 != null">
	        #{aca111,jdbcType=VARCHAR},
	      </if>
	      <if test="chb105 != null">
	        #{chb105,jdbcType=VARCHAR},
	      </if>
	      <if test="chb106 != null">
	        #{chb106,jdbcType=VARCHAR},
	      </if>
	      <if test="aae100 != null">
	        #{aae100,jdbcType=VARCHAR},
	      </if>
	      <if test="aae011 != null">
	        #{aae011,jdbcType=VARCHAR},
	      </if>
	      <if test="aae013 != null">
	        #{aae013,jdbcType=VARCHAR},
	      </if>
	      <if test="aae036 != null">
	        #{aae036,jdbcType=DATE},
	      </if>
	      <if test="chb528 != null" >
	      	#{chb528,jdbcType=VARCHAR},
	      </if>
	      <if test="chb316 != null" >
	      	#{chb316,jdbcType=VARCHAR},
	      </if>
	      <if test="chb188 != null" >
	      	#{chb188,jdbcType=VARCHAR}
	      </if>
	    </trim>
	</insert>
	<update id="updateClass" parameterType="Hb68">
		update hb68
		<set>
			chb527 = '1'
		</set>
		where 
			chb068 in <foreach item="item" collection="chb068s" open="(" separator="," close=")">
            				#{item}
        	          </foreach>
	</update>
	<insert id="addHb66" parameterType="Hb66" >
		<selectKey resultType="java.lang.String" order="BEFORE" keyProperty="chb066">
            select sys_guid() from dual
        </selectKey>
		insert into hb66
		<trim prefix="(" suffix=")" suffixOverrides=",">
	        CHB066,
	      <if test="chb067 != null">
	        CHB067,
	      </if>
	      <if test="chb068 != null">
	        CHB068,
	      </if>
	    </trim>
	    <trim prefix="values (" suffix=")" suffixOverrides=",">
	        #{chb066,jdbcType=VARCHAR},
	      <if test="chb067 != null">
	        #{chb067,jdbcType=VARCHAR},
	      </if>
	      <if test="chb068 != null">
	        #{chb068,jdbcType=VARCHAR},
	      </if>
	    </trim>
	</insert>
	<update id="updateHb68Chb528" parameterType="Hb68">
		update hb68
		<set>
			chb528 = '1'
		</set>
		where 
			chb068 in <foreach item="item" collection="chb068s" open="(" separator="," close=")">
            				#{item}
        	          </foreach>
	</update>
</mapper>